<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script>
    
var initData = window.JSON.parse(<?= initData ?>);

window.addEventListener("load", function() {
  document.getElementById("scriptUrl").value = initData.scriptURL;
  document.getElementById("password").value = initData.scriptPassword;
  document.getElementById("callback").value = initData.scriptCallback;
  document.getElementById("origin").value = initData.origin;
  document.getElementById("originLock").checked = initData.originLock ? true : false;
  addhosthingList(initData.cdn, "cdn");
  addhosthingList(initData.css, "css");
});

function addhosthingList(list, listName) {
  if(list){
    let arr = list.split(",");
    for (var i = 0; i < arr.length; i++) {
      addList(listName, ' value="' + arr[i] + '"');
    }
  }
}
function sideBarClose(res){
alert(res);
}
function addList(hostingListName, val) {
  let span = document.createElement("span");
  span.innerHTML =
    '<i class="material-icons" style="font-size:18px;">cancel</i>';
  span.class = "delete";
  span.style = "margin-left: 5px;margin-top:30px;";
  span.addEventListener("click", function(event) {
    let remove = event.target.parentNode.parentNode;
    remove.parentNode.removeChild(remove);
  });
  let tableOl = document.getElementById(hostingListName + "-list");
  let li = document.createElement("li");
  li.innerHTML = '<input class="formLi" name="'+ hostingListName +'List" placeholder="Hosting url"' + val + '>';
  li.appendChild(span);
  tableOl.appendChild(li);
}

    </script>
  </head>
  <body>
    <form id="bookmarklet-form">
      <label><?= urlLavel ?></label> 
      <div><input id="scriptUrl" name="scriptUrl"/></div>
      <label><?= passwordLavel ?></label>
      <div><input id="password" name="password"/></div>
      <label><?= callbackLabel ?></label>
      <div><input id="callback" name="callback"/></div>
      <label><?= originLavel ?></label>
      <div>
        <input id="origin" name="origin"/><input id="originLock" type="checkbox" name="originLock"><?= originLockLabel ?>
      </div>
      <p><label>hosting service</label></p>
      <div>
        <button id="cdn-list-button" type="button" onclick="addList('cdn');">
          Add cdn
        </button>
      </div>
      <ol id="cdn-list" name="cdnList" style="padding-left: 20px;"></ol>
      <div>
        <button id="css-list-button" type="button" onclick="addList('css');">
          Add css
        </button>
      </div>
      <ol id="css-list" style="padding-left: 20px;"></ol>
      <p>
        <button id="appry-butto" type="button" onclick="google.script.run.withSuccessHandler(sideBarClose).setBookmarkletLoader(this.parentNode.parentNode);">
          Appry
        </button>
      </p>
    </form>
  </body>
</html>
